<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>c(x) intro | rasie1&#39;s blog</title>
<meta name="keywords" content="programming language theory, fp, types, refinement types" />
<meta name="description" content="One of articles about my old project with cool type system">
<meta name="author" content="Vsevolod Kvachev">
<link rel="canonical" href="https://kvachev.com/blog/posts/c-of-x-intro/" />
<link crossorigin="anonymous" href="/blog/assets/css/stylesheet.min.c37a1fc90e510161a636790676adc7ccbaebdfcd7c141a8cc34a01508787bbfc.css" integrity="sha256-w3ofyQ5RAWGmNnkGdq3HzLrr3818FBqMw0oBUIeHu/w=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/blog/assets/js/highlight.min.3845510db7f3c2a193f085acd0a874aa81a550507c81e6e2dabe1b23d41fdc60.js" integrity="sha256-OEVRDbfzwqGT8IWs0Kh0qoGlUFB8gebi2r4bI9Qf3GA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://kvachev.com/blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://kvachev.com/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://kvachev.com/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://kvachev.com/blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://kvachev.com/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.92.0" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #000;
                --entry: rgb(2, 2, 2);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                --accent: #5AF;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P7B3CD65K7"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-P7B3CD65K7', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="c(x) intro" />
<meta property="og:description" content="One of articles about my old project with cool type system" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kvachev.com/blog/posts/c-of-x-intro/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-10T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2017-05-10T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="c(x) intro"/>
<meta name="twitter:description" content="One of articles about my old project with cool type system"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://kvachev.com/blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "c(x) intro",
      "item": "https://kvachev.com/blog/posts/c-of-x-intro/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "c(x) intro",
  "name": "c(x) intro",
  "description": "One of articles about my old project with cool type system",
  "keywords": [
    "programming language theory", "fp", "types", "refinement types"
  ],
  "articleBody": "Design and Implementation of Programming Language with Generalized Sets, Types, and Functions as First-Class Values Disclaimer: This is a very formal and old article about one of my old project of designing and making a language with mad, nearly esoteric, but still cool type system with composable gradual refinements. I felt like it should not be forgotten and put it into this blog; I will write some expansions of ideas described here soon. The implementation is of course unfinished and it’s interpreted instead of compiled, but still\nAbstract We present several design ideas for an experimental programming language featuring flexible and expressive type system that ensures error prevention while preserving readability, maintainability and convenience of writing code. We argue that this goal can be achieved by unifying syntactic approach to types, sets, and functions in order to make them composable and interchangeable, and by implementing possibility to use all of them as first class citizens. In this paper we give a high-level overview of the main language features along with some implementation details. We conclude with plans for future work.\nIntroduction Many modern programming languages, such as Haskell, Scala, Agda, use rich type systems for preventing defects and specifying requirements for program entities and operations on them, increasing expressiveness and usability. There are two well-known approaches to advancing type systems, that draw much attention nowadays: dependent types and refinement types. While dependent types allow types to depend on values, refinement types provide an ability to augment types with logical predicates. Dependent types typically require higher amounts of assistance by programmers. Opposing to them, type systems based on refinement types have a high degree of automation and expressiveness of verification of program code. Refinement types do not require detailed proofs as systems with dependent types do, and they allow user to conveniently construct the constraints. In many existing implementations of systems with refinement types, the refinements are orthogonal to the base types system of the language. For example, in LiquidHaskell, which is an extension of Haskell programming language, constructions with refinement types are specified in the form of special annotations and used exclusively for static validation of the source code. In refinement type annotations specifying base types is mandatory even if they can be inferred from program code. The integration of logical predicates into the type system and building language around refinements potentially give us new ways of solving problems. In this paper, we attempt to design a language with a novel approach to type refinements.\nGeneralization of Sets, Types, and Functions The syntactic and semantic possibilities of systems with refinement types can be extended by unifying the approach to the usage of types, sets, and functions. Let’s see what we can do. We use types to annotate values to limit them to some set of values. Firstly, we can do exact same thing with sets.\nx : Int y : {1, 2, 3, 4, 5} In this example, we set x to be a variable of base type of integers and y to be in a set.\nWe can apply the same approach to predicates:\nEven x = (x % 2 = 0) a : Even // suppose Lowercase is predicate for lowercase strings myString : Lowercase x = 0 As can be seen from these examples, predicates and sets are possible to be used literally in place of types: there is no special syntax to distinguish them. To make such behaviour possible, we should introduce a program entity that generalizes predicates, types, and sets, and takes a value as an argument and returns it if the particular condition is met. If the predicate is not satisfied, value should not be returned and this case should be considered as type error.\nNow let’s see how these definitions can be used inside functions.\nmyFunction (x : Even) = div x 2 Successful type checking when using this function implies that intersection of domain of function (expected type of argument) with actual argument is non-empty.\nIn the designed programming language, usage of these unified program entities is carried out by the same generalized operations: intersection, union and other, including user-defined operations. Another important feature is the ability to use arbitrary functions, including anonymous ones, at the type level.\nHere we show some fragments of the program code that illustrates these features.\nNat = Int, (=0) In this example, we define type of natural numbers as an intersection of integer base type and positive predicate expressed with partially applied more-or-equal operator. Let’s use them in the defininition of a function.\nmyFunction y (x : Even, Nat {1, 2, 3, 4, 5} (1)} = {x + 1} myFunction takes two arguments: y and x. The second argument is even natural number from the set containing concrete values. The second argument x is also less than the first argument y. Function returns a set of integers greater than 1. Return value is defined as set of all possible x increased by one. y here is constrained only by possibility to use of less-than operator.\nIn this language, type annotations do not forbid possibility of using functions inside them, if it is possible for them to compute their inverse functions. In some cases this is trivial and can done automatically (for example, increasing by a number, or returning a value that satisfies a condition), in other cases the behavior can be defined by user, making him able to prohibit some cases (such as division by zero for inverse of function of multiplying by number).\nHere is an example of more advanced usage of inverse functions.\nPerson = has firstName : String lastName : String parsePerson (firstName ++ \" \" ++ lastName) = Person firstName lastName input At the first lines, we define Person record. Then, parsePerspon function is defined using pattern-matching-like syntax involving an inverse operation of concatenation function. Implementation of inverse concatenation (++) might be quite complex, but it can be made to parse more complex cases, such as regular expressions, or functions generating lists.\nAt the end of the listing, usage of parsePerson is shown. If input string wasn’t matched with parsePerson’s pattern, default value specified by alternative branch of the if expression.\nImplementation As a prototype implementation of the programming language, we developed static typechecker. It can also work as an interpreter and read-eval-print loop to analyze evaluation of expressions in this programming language, but we still can’t call it a full implementation of an interpreter as we still have not fully designed the input-output system and now use impure functions as placeholder for input and output in programs.\nThe interpreter converts the text of a program into a system of judgments about variables. The system can be checked by an SMT solver, and normalized to specific values ​​(if there is enough information to do this), dynamically evaluating expressions of the language.\nWe chose C++as language of implementation. Source code of implementation is available in our repository on GitHub . At the moment of writing this paper, the most actual code is in branch cast-eval.\nLet’s point out main aspects of architecture of this type checker.\nAt current stage, implementation can be considered as naive, as it mostly involves evaluating every expression (including types and computations at the type level) using wide set of pre-defined operations, and the fact that entities of this language are based around inheritance hierarchy and utilizing C++ type system and templates.\nWe can divide the architecture of interpreter into two parts: “expressions” and “system”. There are also tools for parsing and running read-eval-print loop, debugging language’s behaviour, etc.\nExpressions part contains around 44 classes describing logic of constructing, using and combining language’s entities. Code contained in second category is defining how basic computations and environment work.\nFuture Work The usage of arbitrary functions in type annotations of a language with static typing is not possible due to the fact that static typechecker might not have enough information about dynamic variables. To retain this possibility, it is required to introduce dynamic language elements: the use of gradual typing would allow to seamlessly combine static and dynamic checks, leaving the latter for the runtime. Gradual types can also be combined with refinement types.\nOne of the nearest steps is to implement separating the stage of static typechecking from runtime checks by introducing gradual typing, and investigation of possible problems.\nWe will also explore embedding an SMT solver such as Z3 into language’s type system for solving complex systems. We also plan to carry research on other language possibilities.\nReferences  Refinement types for secure implementations, J. Bengtson and K. Bhargavan and C. Fournet and A. D. Gordon and S. Maffeis Bounded Refinement Types - Niki Vazou and Alexander Bakst and Ranjit Jhala Gradual Refinement Types - Nicolás Lehmann and Éric Tanter Gradual Typing for Functional Languages - Jeremy G. Siek and Walid Taha Abstracting Gradual Typing - Ronald Garcia and Alison M. Clark and Éric Tanter Liquid Intersection Types - Mário Pereira and Sandra Alves and Mário Florido, Union, Intersection, and Refinement Types and Reasoning About Type Disjointness for Secure Protocol Implementations - Backes, Michael and Hriţcu, Cătălina and Maffei, Matteoa Refinement types for ML - Tim Freeman and Frank Pfenning LiquidHaskell: Experience with Refinement Types in the Real World - Niki Vazou and Eric L. Seidel and Ranjit Jhala ",
  "wordCount" : "1571",
  "inLanguage": "en",
  "datePublished": "2017-05-10T00:00:00Z",
  "dateModified": "2017-05-10T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Vsevolod Kvachev"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://kvachev.com/blog/posts/c-of-x-intro/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "rasie1's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://kvachev.com/blog/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://kvachev.com/blog" accesskey="h" title="rasie1&#39;s blog (Alt + H)">rasie1&#39;s blog</a>
        </div>
        <ul id="menu">
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                        <circle fill="var(--code-bg)" cx="12" cy="12" r="12"/>
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle fill="var(--code-bg)" stroke="none" cx="12" cy="12" r="12"/>
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
            <li>
                <a href="https://kvachev.com/blog/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://kvachev.com/blog/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://kvachev.com/blog/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      c(x) intro
    </h1>
    <div class="post-description">
      One of articles about my old project with cool type system
    </div>
    <div class="post-meta"><span title='2017-05-10 00:00:00 +0000 UTC'>May 10, 2017</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Vsevolod Kvachev

</div>
  </header> <div class="toc side right">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#design-and-implementation-ofnbspprogramming-language-with-generalized-sets-types-and-functions-asnbspfirst-class-values" aria-label="Design and Implementation of Programming Language with Generalized Sets, Types, and Functions as First-Class Values">Design and Implementation of Programming Language with Generalized Sets, Types, and Functions as First-Class Values</a><ul>
                        
                <li>
                    <a href="#abstract" aria-label="Abstract">Abstract</a></li>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#generalization-ofnbspsets-types-and-functions" aria-label="Generalization of Sets, Types, and Functions">Generalization of Sets, Types, and Functions</a></li>
                <li>
                    <a href="#implementation" aria-label="Implementation">Implementation</a></li>
                <li>
                    <a href="#future-work" aria-label="Future Work">Future Work</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="design-and-implementation-ofnbspprogramming-language-with-generalized-sets-types-and-functions-asnbspfirst-class-values">Design and Implementation of Programming Language with Generalized Sets, Types, and Functions as First-Class Values<a hidden class="anchor" aria-hidden="true" href="#design-and-implementation-ofnbspprogramming-language-with-generalized-sets-types-and-functions-asnbspfirst-class-values">#</a></h1>
<p><em>Disclaimer: This is a very formal and old article about one of my old project of designing and making a language with mad, nearly esoteric, but still cool type system with composable gradual refinements. I felt like it should not be forgotten and put it into this blog; I will write some expansions of ideas described here soon. The <a href="http://github.com/rasie1/c-of-x">implementation</a> is of course unfinished and it&rsquo;s interpreted instead of compiled, but still</em></p>
<h2 id="abstract">Abstract<a hidden class="anchor" aria-hidden="true" href="#abstract">#</a></h2>
<p>We present several design ideas for an experimental programming language featuring flexible and expressive type system that ensures error prevention while preserving readability, maintainability and convenience of writing code.
We argue that this goal can be achieved by unifying syntactic approach to types, sets, and functions in order to make them composable and interchangeable, and by implementing possibility to use all of them as first class citizens. In this paper we give a high-level overview of the main language features along with some implementation details.  We conclude with plans for future work.</p>
<h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>Many modern programming languages, such as Haskell, Scala, Agda, use rich type systems for preventing defects and specifying requirements for program entities and operations on them, increasing expressiveness and usability. There are two well-known approaches to advancing type systems, that draw much attention nowadays: dependent types and refinement types. While dependent types allow types to depend on values, refinement types provide an ability to augment types with logical <a href="https://www.cs.cmu.edu/~fp/papers/pldi91.pdf">predicates</a>. Dependent types typically require higher amounts of assistance by programmers. Opposing to them, type systems based on refinement types have a high degree of automation and expressiveness of verification of program code.
Refinement types do not require detailed proofs as systems with dependent types do, and they allow user to conveniently construct the <a href="https://ranjitjhala.github.io/static/bounded_refinement_types.pdf">constraints</a>. In many existing implementations of systems with refinement types, the refinements are orthogonal to the base types system of the language. For example, in <a href="http://goto.ucsd.edu/~nvazou/real_world_liquid.pdf">LiquidHaskell</a>, which is an extension of Haskell programming language, constructions with refinement types are specified in the form of special annotations and used exclusively for static validation of the <a href="http://goto.ucsd.edu/~nvazou/real_world_liquid.pdf">source code</a>. In refinement type annotations specifying base types is mandatory even if they can be inferred from program code. The integration of logical predicates into the type system and building language around refinements potentially give us new ways of solving problems. In this paper, we attempt to design a language with a novel approach to type refinements.</p>
<h2 id="generalization-ofnbspsets-types-and-functions">Generalization of Sets, Types, and Functions<a hidden class="anchor" aria-hidden="true" href="#generalization-ofnbspsets-types-and-functions">#</a></h2>
<p>The syntactic and semantic possibilities of systems with refinement types can be extended by unifying the approach to the usage of types, sets, and functions. Let&rsquo;s see what we can do.
We use types to annotate values to limit them to some set of values. Firstly, we can do exact same thing with <code>sets</code>.</p>
<pre tabindex="0"><code>x : Int
y : {1, 2, 3, 4, 5}
</code></pre><p>In this example, we set <code>x</code> to be a variable of base type of integers and <code>y</code> to be in a set.</p>
<p>We can apply the same approach to <code>predicates</code>:</p>
<pre tabindex="0"><code>Even x = (x % 2 = 0)
a : Even
// suppose Lowercase 
   is predicate for lowercase strings
myString : Lowercase
x = 0
</code></pre><p>As can be seen from these examples, predicates and sets are possible to be used literally in place of types: there is no special syntax to distinguish them. To make such behaviour possible, we should introduce a program entity that generalizes predicates, types, and sets, and takes a value as an argument and returns it if the particular condition is met. If the predicate is not satisfied, value should not be returned and this case should be considered as type error.</p>
<p>Now let&rsquo;s see how these definitions can be used inside functions.</p>
<pre tabindex="0"><code>myFunction (x : Even) = div x 2
</code></pre><p>Successful type checking when using this function implies that intersection of domain of function (expected type of argument) with actual argument is non-empty.</p>
<p>In the designed programming language, usage of these unified program entities is carried out by the same generalized operations: <a href="https://repositorio-aberto.up.pt/bitstream/10216/75622/2/31976.pdf">intersection</a>, <a href="http://prosecco.gforge.inria.fr/personal/hritcu/publications/rcf-and-or-coq-jcs2014.pdf">union</a> and other, including user-defined operations. Another important feature is the ability to use arbitrary functions, including anonymous ones, at the type level.</p>
<p>Here we show some fragments of the program code that illustrates these features.</p>
<pre tabindex="0"><code>Nat = Int, (&gt;=0)
</code></pre><p>In this example, we define type of natural numbers as an intersection of integer base type and positive predicate expressed with partially applied more-or-equal operator. Let&rsquo;s use them in the defininition of a function.</p>
<pre tabindex="0"><code>myFunction y (x : Even, 
                  Nat {1, 2, 3, 4, 5}
                  (&lt;y)) 
    : {Int &amp; (&gt;1)} 
    = {x + 1}
</code></pre><p><code>myFunction</code> takes two arguments: <code>y</code> and <code>x</code>. The second argument is even natural number from the set containing concrete values. The second argument <code>x</code> is also less than the first argument <code>y</code>. Function returns a set of integers greater than <code>1</code>. Return value is defined as set of all possible <code>x</code> increased by one. <code>y</code> here is constrained only by possibility to use of less-than operator.</p>
<p>In this language, type annotations do not forbid possibility of using functions inside them, if it is possible for them to compute their <code>inverse functions</code>. In some cases this is trivial and can done automatically (for example, increasing by a number, or returning a value that satisfies a condition), in other cases the behavior can be defined by user, making him able to prohibit some cases (such as division by zero for inverse of function of multiplying by number).</p>
<p>Here is an example of more advanced usage of inverse functions.</p>
<pre tabindex="0"><code>Person = has firstName : String
             lastName  : String
parsePerson (firstName ++ &quot; &quot; ++ lastName) 
    = Person firstName lastName
    
input &lt;- read String
person : Person = 
    if parsed = parsePerson input
       then parsed
       else Person &quot;John&quot; &quot;Doe&quot;
</code></pre><p>At the first lines, we define <code>Person</code> record. Then, <code>parsePerspon</code> function is defined using pattern-matching-like syntax involving an inverse operation of concatenation function. Implementation of inverse concatenation (<code>++</code>) might be quite complex, but it can be made to parse more complex cases, such as regular expressions, or functions generating lists.</p>
<p>At the end of the listing, usage of <code>parsePerson</code> is shown. If input string wasn&rsquo;t matched with <code>parsePerson</code>&rsquo;s pattern, default value specified by alternative branch of the <code>if</code> expression.</p>
<h2 id="implementation">Implementation<a hidden class="anchor" aria-hidden="true" href="#implementation">#</a></h2>
<p>As a prototype implementation of the programming language, we developed static typechecker. It can also work as an interpreter and read-eval-print loop to analyze evaluation of expressions in this programming language, but we still can&rsquo;t call it a full implementation of an interpreter as we still have not fully designed the input-output system and now use impure functions as placeholder for input and output in programs.</p>
<p>The interpreter converts the text of a program into a system of judgments about variables. The system can be checked by an SMT solver, and normalized to specific values ​​(if there is enough information to do this), dynamically evaluating expressions of the language.</p>
<p>We chose <code>C++</code>as language of implementation. Source code of implementation is available in our repository on <a href="http://github.com/rasie1/c-of-x">GitHub</a> . At the moment of writing this paper, the most actual code is in branch <code>cast-eval</code>.</p>
<p>Let&rsquo;s point out main aspects of architecture of this type checker.</p>
<p>At current stage, implementation can be considered as naive, as it mostly involves evaluating every expression (including types and computations at the type level) using wide set of pre-defined operations, and the fact that entities of this language are based around inheritance hierarchy and utilizing C++ type system and templates.</p>
<p>We can divide the architecture of interpreter into two parts: &ldquo;expressions&rdquo; and &ldquo;system&rdquo;. There are also tools for parsing and running read-eval-print loop, debugging language&rsquo;s behaviour, etc.</p>
<p>Expressions part contains around 44 classes describing logic of constructing, using and combining language&rsquo;s entities. Code contained in second category is defining how basic computations and environment work.</p>
<h2 id="future-work">Future Work<a hidden class="anchor" aria-hidden="true" href="#future-work">#</a></h2>
<p>The usage of arbitrary functions in type annotations of a language with static typing is not possible due to the fact that static typechecker might not have enough information about dynamic variables. To retain this possibility, it is required to introduce dynamic language elements: the use of gradual typing would allow to seamlessly combine static and dynamic checks, leaving the latter for the <a href="https://dl.acm.org/doi/pdf/10.1145/2837614.2837670">runtime</a>. Gradual types can also be combined with <a href="https://www.dcc.uchile.cl/TR/2016/TR_DCC-20161107-001.pdf">refinement types</a>.</p>
<p>One of the nearest steps is to implement separating the stage of static typechecking from runtime checks by introducing gradual typing, and investigation of possible problems.</p>
<p>We will also explore embedding an SMT solver such as <code>Z3</code> into language&rsquo;s type system for solving complex systems. We also plan to carry research on other language possibilities.</p>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<ul>
<li><a href="https://www.doc.ic.ac.uk/~maffeis/papers/toplas11.pdf">Refinement types for secure implementations</a>, J. Bengtson and  K. Bhargavan and  C. Fournet and  A. D. Gordon and S. Maffeis</li>
<li><a href="https://ranjitjhala.github.io/static/bounded_refinement_types.pdf">Bounded Refinement Types</a> - Niki Vazou and Alexander Bakst and Ranjit Jhala</li>
<li><a href="https://www.dcc.uchile.cl/TR/2016/TR_DCC-20161107-001.pdf">Gradual Refinement Types</a> - Nicolás Lehmann and Éric Tanter</li>
<li><a href="http://scheme2006.cs.uchicago.edu/13-siek.pdf">Gradual Typing for Functional Languages</a> - Jeremy G. Siek and Walid Taha</li>
<li><a href="https://dl.acm.org/doi/pdf/10.1145/2837614.2837670">Abstracting Gradual Typing</a> - Ronald Garcia and Alison M. Clark and Éric Tanter</li>
<li><a href="https://repositorio-aberto.up.pt/bitstream/10216/75622/2/31976.pdf">Liquid Intersection Types</a> - Mário Pereira and Sandra Alves and Mário Florido,</li>
<li><a href="http://prosecco.gforge.inria.fr/personal/hritcu/publications/rcf-and-or-coq-jcs2014.pdf">Union, Intersection, and Refinement Types and Reasoning About Type Disjointness for Secure Protocol Implementations</a> - Backes, Michael and Hriţcu, Cătălina and Maffei, Matteoa</li>
<li><a href="https://www.cs.cmu.edu/~fp/papers/pldi91.pdf">Refinement types for ML</a> - Tim Freeman and Frank Pfenning</li>
<li><a href="http://goto.ucsd.edu/~nvazou/real_world_liquid.pdf">LiquidHaskell: Experience with Refinement Types in the Real World</a> - Niki Vazou and Eric L. Seidel and Ranjit Jhala</li>
</ul>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://kvachev.com/blog/tags/programming-language-theory/">programming language theory</a></li>
      <li><a href="https://kvachev.com/blog/tags/fp/">fp</a></li>
      <li><a href="https://kvachev.com/blog/tags/types/">types</a></li>
      <li><a href="https://kvachev.com/blog/tags/refinement-types/">refinement types</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://kvachev.com/blog/posts/grpc-with-unreal-engine/">
    <span class="title">« Prev Page</span>
    <br>
    <span>GRPC with Unreal Engine</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share c(x) intro on twitter"
        href="https://twitter.com/intent/tweet/?text=c%28x%29%20intro&amp;url=https%3a%2f%2fkvachev.com%2fblog%2fposts%2fc-of-x-intro%2f&amp;hashtags=programminglanguagetheory%2cfp%2ctypes%2crefinementtypes">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share c(x) intro on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fkvachev.com%2fblog%2fposts%2fc-of-x-intro%2f&amp;title=c%28x%29%20intro&amp;summary=c%28x%29%20intro&amp;source=https%3a%2f%2fkvachev.com%2fblog%2fposts%2fc-of-x-intro%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share c(x) intro on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fkvachev.com%2fblog%2fposts%2fc-of-x-intro%2f&title=c%28x%29%20intro">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share c(x) intro on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fkvachev.com%2fblog%2fposts%2fc-of-x-intro%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share c(x) intro on telegram"
        href="https://telegram.me/share/url?text=c%28x%29%20intro&amp;url=https%3a%2f%2fkvachev.com%2fblog%2fposts%2fc-of-x-intro%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://kvachev.com/blog">rasie1&#39;s blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>



<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>

    <script>
    
    
    (function() {
        const enableTocScroll = '1' == '1'
        if (!enableTocScroll) {
        return
        }
        if (!document.querySelector('.toc')) {
        console.log('no toc found, ignore toc scroll')
        return
        }
        

        
        const scrollListeners = window.scrollListeners
        const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
        const activeClass = 'active';

        
        let activeHeading = headings[0];
        getLinkByHeading(activeHeading).classList.add(activeClass);

        const onScroll = () => {
        const passedHeadings = [];
        for (const h of headings) {
            
            if (getOffsetTop(h) < 5) {
            passedHeadings.push(h)
            } else {
            break;
            }
        }
        if (passedHeadings.length > 0) {
            newActiveHeading = passedHeadings[passedHeadings.length - 1];
        } else {
            newActiveHeading = headings[0];
        }
        if (activeHeading != newActiveHeading) {
            getLinkByHeading(activeHeading).classList.remove(activeClass);
            activeHeading = newActiveHeading;
            getLinkByHeading(activeHeading).classList.add(activeClass);
        }
        }

        let timer = null;
        const scrollListener = () => {
        if (timer !== null) {
            clearTimeout(timer)
        }
        timer = setTimeout(onScroll, 50)
        }
        window.addEventListener('scroll', scrollListener, false);
        scrollListeners.push(scrollListener)

        function getLinkByHeading(heading) {
        const id = encodeURI(heading.getAttribute('id')).toLowerCase();
        return document.querySelector(`.toc ul li a[href="#${id}"]`);
        }

        function getOffsetTop(heading) {
        if (!heading.getClientRects().length) {
            return 0;
        }
        let rect = heading.getBoundingClientRect();
        return rect.top
        }
    })();
    </script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>

    <script>
        function changeTab(evt, tabset, tabName) {
            var tabcontent = document.querySelectorAll('.tabcontent[data-tabset="' + tabset + '"]');
            for (var i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            var tablinks = document.querySelectorAll('.tablinks[data-tabset="' + tabset + '"]');
            for (var i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            var elements = document.querySelectorAll('[data-tabset="' + tabset + '"][id=' + tabName + ']');
            for (var i = 0; i < elements.length; ++i) {
                elements[i].style.display = "block";
            }

            evt.currentTarget.className += " active";
        } 

        $(function() {
            let tabsetset = [];

            document.querySelectorAll('.tablinks').forEach((el) => {
                let attr = el.attributes['data-tabset'].value;
                if (!tabsetset.includes(attr)) {
                    tabsetset.push(attr);
                    el.click();
                }
            })
        });
        function changeTabs(evt, tabset, tabName) {
            var tabcontent = document.querySelectorAll('.tabcontent');
            for (var i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            var tablinks = document.querySelectorAll('.tablinks');
            for (var i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            var elements = document.querySelectorAll('.tabcontent[id=' + tabName + ']');
            for (var i = 0; i < elements.length; ++i) {
                elements[i].style.display = "block";
            }
            var elements = document.querySelectorAll('.tablinks[id=' + tabName + ']');
            for (var i = 0; i < elements.length; ++i) {
                elements[i].className += " active";
            }
        } 
    </script>
</body>

</html>
